{% extends 'base-blog.html' %}

{% block title %}{{ tag_name }}æ ‡ç­¾åˆ—è¡¨-å´”äº®çš„åšå®¢{% endblock %}

{% block content %}
    <!--ä¸­é—´ä¸»ä½“éƒ¨åˆ†-->
    <main class="page-main  clearfix">
        <div class="layui-row">
            <!--        &lt;!&ndash;    é¡µé¢å·¦ä¾§ç•™ç©º&ndash;&gt;-->
            <!--        <div class="layui-hide-xs layui-col-sm1 layui-col-md2 left-null">-->
        </div>
        <!--    é¡µé¢ä¸»ä½“éƒ¨åˆ†-->
        <div class="layui-col-md-offset2 layui-col-sm12 layui-col-md8 page-main-centre">
            <div class="layui-row main-centre">
                <!--            ä¸»ä½“å·¦ä¾§éƒ¨åˆ†-->
                <div class="layui-col-md9 main-left">
                    <!--                    ä½ç½®ä¿¡æ¯-->
                    <blockquote class="layui-elem-quote location suspend">
                        <p>æ‚¨çš„ä½ç½®ï¼š <a href="/">é¦–é¡µ</a>
                            <i class="layui-icon layui-icon-next"></i>
                            <span>æ ‡ç­¾åˆ†ç±»</span>
                            <i class="layui-icon layui-icon-next"></i>
                            <span>{{ tag_name }}</span>
                        </p>
                    </blockquote>
                    <!--            æ–‡ç« åˆ—è¡¨-->
                    <div class="index-new">
                        <h4 id="list-title">
                            <strong>
                                <span>ğŸ“œ æ–‡ç« åˆ—è¡¨</span>
                            </strong>
                        </h4>
                        <div id="paging"></div>
                    </div>
                </div>
                {% include 'blog/aside.html' %}
                <!--            ä¸»ä½“å³ä¾§éƒ¨åˆ†-->
            </div>
        </div>
        </div>
    </main>
{% endblock %}

{% block js %}
    <script>

        layui.use(['laypage', 'layer', 'flow'], function () {
            var laypage = layui.laypage
                , layer = layui.layer
                , flow = layui.flow;

            // åˆ†é¡µ
            laypage.render({
                elem: 'paging'
                , count: {{ count }}
                , limit: 10
                , limits: [10, 20, 30, 40, 50]
                , layout: ['prev', 'page', 'next', 'limit', 'limits', 'count']
                , jump: function (obj, first) {
                    if (first) {
                        // è·å–ç¬¬ä¸€é¡µå†…å®¹
                        $.ajax({
                            type: "GET",
                            url: "{% url 'blog:tagPage' %}",
                            data: {
                                tag_id: {{ tag_id }},
                                limit: obj.limit,
                                page: 1
                            },
                            success: function (result) {
                                if (result.code == 1) {
                                    $(".article-box").remove();
                                    $("#list-title").after(createEle(result));
                                    // æ—¶é—´æ˜¾ç¤ºå‡ å¤©å‰
                                    var timeago = layui.timeago;
                                    timeago.render($('.timeago'));
                                } else {
                                    layer.alert(result.msg, {icon: 2});
                                }
                            },
                            error: function (xhr) {
                                alert(xhr.text());
                            }
                        })
                    } else {
                        //æ¢é¡µæ‰§è¡Œ
                        $.ajax({
                            type: "GET",
                            url: "{% url 'blog:tagPage' %}",
                            data: {
                                tag_id: {{ tag_id }},
                                limit: obj.limit,
                                page: obj.curr
                            },
                            success: function (result) {
                                if (result.code == 1) {
                                    $(".article-box").remove();
                                    $("#list-title").after(createEle(result));
                                    // æ—¶é—´æ˜¾ç¤ºå‡ å¤©å‰
                                    var timeago = layui.timeago;
                                    timeago.render($('.timeago'));
                                } else {
                                    layer.alert(result.msg, {icon: 2});
                                }
                            },
                            error: function (xhr) {
                                alert(xhr.text());
                            }
                        })
                    }
                }
            });
        });

        // æ ¹æ®ajaxè¿”å›åˆ†é¡µç»“æœåˆ›å»ºå†…å®¹
        function createEle(result) {
            var lis = [];
            layui.each(result.data, function (index, item) {
                var article = $("<div class=\"layui-row layui-col-space20 article-box\">\n" +
                    "    <div class=\"layui-col-xs12 layui-col-md4\">\n" +
                    "        <div class=\"img-cover img-zoom\">\n" +
                    "            <a href=\"/blog/show-" + item.id + "\" title=\"" + item.title + "\">\n" +
                    "                <img width=\"100%\" lay-src=\"{{ MEDIA_URL }}" + item.img + "\">\n" +
                    "            </a>\n" +
                    "        </div>\n" +
                    "    </div>\n" +
                    "    <div class=\"layui-col-xs12 layui-col-md8\">\n" +
                    "        <h3>\n" +
                    "            <a href=\"/blog/show-" + item.id + "\">" + item.title + "</a>\n" +
                    "        </h3>\n" +
                    "        <p class=\"txt-cont hidden-xs\">\n" +
                    "            <a href=\"/blog/show-" + item.id + "\">" + item.excerpt + "</a>\n" +
                    "        </p>\n" +
                    "        <div class=\"list-article-info\">\n" +
                    "            <a href=\"/blog/category-" + item.category_id + "\" class=\"label-tag tag-color-" + item.category_id + "\">" + item.category + "</a>\n" +
                    "            <span>\n" +
                    "                    <i class=\"fas fa-clock\">\n" +
                    "                       <span class=\"timeago\" datetime=\"" + item.created_time + "\"'></span>" +
                    "                    </i>\n" +
                    "                </span>\n" +
                    "            <span>\n" +
                    "                    <i class=\"fas fa-eye\">" + item.view + "</i>\n" +
                    "                </span>\n" +
                    "            <span>\n" +
                    "                    <i class=\"fas fa-thumbs-up\">" + item.like + "</i>\n" +
                    "                </span>\n" +
                    "            <span>\n" +
                    "                    <i class=\"fas fa-heart\">" + item.collection + "</i>\n" +
                    "                </span>\n" +
                    "            <span>\n" +
                    "                    <i class=\"fas fa-comment-dots\">" + item.comment + "</i>\n" +
                    "                </span>\n" +
                    "        </div>\n" +
                    "    </div>\n" +
                    "</div>")
                lis.push(article);
            });
            return lis;
        }
    </script>
{% endblock %}